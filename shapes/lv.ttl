@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rml: <http://w3id.org/rml/> .
@prefix rmlsh: <http://w3id.org/rml/shapes/> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

<http://w3id.org/rml/lv/shapes> a owl:Ontology ;
    owl:imports <http://w3id.org/rml/core/shapes> ;
    owl:imports <http://w3id.org/rml/io/shapes> ; 
.

# rml:LogicalView
rmlsh:LogicalViewShape a sh:NodeShape ;
    sh:name "LogicalView" ;
    sh:description """
    A logical view is ...
    """ ;
    sh:message """
    Logical view requires ...
    """ ;
    sh:targetClass rml:LogicalView ;
    sh:targetObjectsOf rml:parentLogicalView ;
    sh:property [
        sh:description """
        TODO describe here and in spec
        """ ;
        sh:message """
        Exactly one rml:onLogicalSource property must be present, with a rml:LogicalSource as its value.
        """ ;
        sh:path rml:source ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:node rmlsh:LogicalSource ;
        sh:nodeKind sh:BlankNodeOrIRI ;
    ] , [
        sh:path rml:field ;
        sh:minCount 1 ;
        sh:nodeKind sh:BlankNodeOrIRI ;
    ] , [
        sh:path [ sh:alternativePath ( rml:leftJoin rml:innerJoin ) ] ;
        sh:nodeKind sh:BlankNodeOrIRI ;
    ] .

rmlsh:FieldShape a sh:NodeShape ;
    sh:name "Field" ;
    sh:description """
    A field is an expression map that gives a name to an expression.
    """ ;
    sh:message """
    rml:Field requires a rml:fieldName and may have zero or more rml:field properties.
    Furthermore, rml:Field requires what an rml:ExpressionMap requires.
    """ ;
    sh:targetClass rml:Field ;
    sh:targetObjectOf rml:field ;
    sh:property [
        sh:path rml:fieldName ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:datatype xsd:string ;
        sh:nodeKind sh:Literal ;
    ] , [
        sh:path rml:field ;
        sh:nodeKind sh:BlankNodeOrIRI ;
    ] .

rmlsh:LogicalViewJoinShape a sh:NodeShape ;
    sh:name "LogicalViewJoin" ;
    sh:description """
    A LogicalViewJoin is an operation that extends the logical iteration of one logical view (the child logical view) with fields from another logical view (the parent logical view).
    """ ;
    sh:message """
    rml:LogicalViewJoin requires a rml:fieldName and may have zero or more rml:field properties.
    Furthermore, rml:Field requires what an rml:ExpressionMap requires.
    """ ;
    sh:targetClass rml:LogicalViewJoin ;
    sh:targetObjectOf rml:leftJoin , rml:innerJoin ;
    sh:property [
        sh:path rml:parentLogicalView ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
        sh:nodeKind sh:BlankNodeOrIRI ;
    ] , [
        sh:path rml:joinCondition ;
        sh:minCount 1 ;
        sh:nodeKind sh:BlankNodeOrIRI ;
    ] , [
        sh:path rml:field ;
        sh:minCount 1 ;
        sh:nodeKind sh:BlankNodeOrIRI ;
    ] .
